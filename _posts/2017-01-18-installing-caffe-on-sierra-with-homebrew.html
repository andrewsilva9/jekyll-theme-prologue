---
layout: post
title: Installing Caffe on Sierra (with homebrew)
date: '2017-01-18T21:58:00.000-05:00'
author: Andrew Silva
tags: 
modified_time: '2017-01-19T22:32:26.195-05:00'
blogger_id: tag:blogger.com,1999:blog-8622339093465720931.post-1756440546390141269
blogger_orig_url: http://www.andrew-silva.com/2017/01/installing-caffe-on-sierra-with-homebrew.html
---

I recently had to install Caffe on a new MacBook Pro, and it was something of an ordeal. I decided to put a short guide up here in the hope that it will make life easier for anyone else trying to get up and running with Caffe but being stuck with some outdated docs.<br /><br />So to get started, the docs are a good reference. You can find them here&nbsp;<a href="http://caffe.berkeleyvision.org/install_osx.html">http://caffe.berkeleyvision.org/install_osx.html</a>&nbsp;and they will require you have homebrew and CUDA. I went ahead and used Cuda 8 (as opposed to the recommended 7). Unfortunately, MacBooks don't have NVIDIA GPUs to take advantage of, but luckily Caffe can be run on CPUs alone.<br /><br />Once you've got the dependencies from the caffe docs, go over to <a href="https://github.com/BVLC/caffe">their git repo</a> and clone it somewhere you'd like to keep it.<br /><br />Once you have that, the Caffe docs are helpful once again for getting the makefile setup (<a href="http://caffe.berkeleyvision.org/installation.html#compilation">http://caffe.berkeleyvision.org/installation.html#compilation</a>). Using homebrew instead of Anaconda, you have to set the python_include and python_lib variables to the homebrew paths. For me, this means:<br /><br /><code>PYTHON_INCLUDE := /usr/local/lib/python2.7/site-packages/numpy/core/include/ /usr/local/Cellar/python/2.7.12_2/Frameworks/Python.framework/Versions/2.7/include/python2.7<br />PYTHON_LIB := /usr/local/Cellar/python/2.7.12_2/Frameworks/Python.framework/Versions/2.7/lib/  </code><br /><div><div><br /></div>Next up, find the "level_db := 0" and uncomment it, and do the same for "cpu_only".<br /><br />Almost there! Open up a Terminal window and use homebrew to uninstall / reinstall openblas (I had to do this because the version Sierra already had was not working properly). Now finally, open up the Makefile.config and set:<br /><code>BLAS := open<br /></code><br /><div><br />There, the Makefile.config changes are finished!<br /><br />Now, when you run:<br /><code>make all&nbsp;</code><br /><code>make test&nbsp;</code><br /><code>make runtest </code><br /><code><br /></code>You might run into a problem that looks similar to this:<br />"<span style="color: #454545; font-family: &quot;helvetica neue&quot;; font-size: 12px;">/build_release/caffe/tools caffe no such file or directory:"</span><br /><span style="color: #454545; font-family: &quot;helvetica neue&quot;; font-size: 12px;"><br /></span>To fix this, I had to create a txt file with the following contents:<br />"<br /><div style="color: #454545; font-family: 'Helvetica Neue'; font-size: 12px; line-height: normal;">caffe</div><div style="color: #454545; font-family: 'Helvetica Neue'; font-size: 12px; line-height: normal;">compute_image_mean</div><div style="color: #454545; font-family: 'Helvetica Neue'; font-size: 12px; line-height: normal;">convert_imageset</div><div style="color: #454545; font-family: 'Helvetica Neue'; font-size: 12px; line-height: normal;">device_query</div><div style="color: #454545; font-family: 'Helvetica Neue'; font-size: 12px; line-height: normal;">dump_network</div><div style="color: #454545; font-family: 'Helvetica Neue'; font-size: 12px; line-height: normal;">extract_features</div><div style="color: #454545; font-family: 'Helvetica Neue'; font-size: 12px; line-height: normal;">finetune_net</div><div style="color: #454545; font-family: 'Helvetica Neue'; font-size: 12px; line-height: normal;">net_speed_benchmark</div><div style="color: #454545; font-family: 'Helvetica Neue'; font-size: 12px; line-height: normal;">test_net</div><div style="color: #454545; font-family: 'Helvetica Neue'; font-size: 12px; line-height: normal;">train_net</div><div style="color: #454545; font-family: 'Helvetica Neue'; font-size: 12px; line-height: normal;">upgrade_net_proto_binary</div><div style="color: #454545; font-family: 'Helvetica Neue'; font-size: 12px; line-height: normal;">upgrade_net_proto_text</div>"<br />Then, in a new Terminal window:<br /><code>for req in $(cat all_execs.txt); do ln -s $req.bin $req; done</code><br /><br />And you should be able to re-make everything and have it work! It's a pain, but having Caffe for local development is worth it!</div></div>