---
layout: post
title: Face Detection and Pose with Caffe in Python
date: '2017-01-19T22:31:00.002-05:00'
author: Andrew Silva
tags: 
modified_time: '2017-01-19T22:31:41.167-05:00'
blogger_id: tag:blogger.com,1999:blog-8622339093465720931.post-1983863726165038584
blogger_orig_url: http://www.andrew-silva.com/2017/01/face-detection-and-pose-with-caffe-in.html
---

I've been working on face detection lately, and Caffe has been tremendously helpful (see my last post for how that installation went...) and provided me with the ability to build on the incredible work available here:&nbsp;<a href="https://github.com/kpzhang93/MTCNN_face_detection_alignment">https://github.com/kpzhang93/MTCNN_face_detection_alignment</a><br /><br />My version of this with Python is adapted from the <a href="https://github.com/DuinoDu/mtcnn">Python version of MTCNN</a>. You can find mine on <a href="https://github.com/andrewsilva9/face_detection_cnn">my GitHub</a>.<br /><br />So what exactly is in that repo? Well for starters there is the model folder, which contains the saved models that the Python files load in and use. Then there is the demo.py file, which had function for initializing a model based on the saved parameters, draw functionality to display images and bounding boxes, as well as some helpers to clean up the results that come back from the convolutional neural networks.<br /><br />There is a "faces" folder with some sample images I used for debugging and testing, which helps to demonstrate not only the success of the models but also their speed as it relates to the size of the image and the number of faces in each image. If you run demo.py, you'll be able to tap '0' to move forward through the directory of images and you'll see bounding boxes for every face the model finds.<br /><br />The face_detector.py file basically allows for the creation of a face detector object, so you can create one and continually give it new images from a different file (if you want to use this model as part of a larger system, for example). There's an example of this in the webcam_runner.py file.<br /><br />The webcam_runner.py file will demonstrate this pretty clearly. Using OpenCV to pull live video from the webcam, the program will take each frame, run it through the face detector, and then display with live video (admittedly at a slower framerate) with faces outlined. It also currently does rudimentary pose estimation by using the position of noses in the bounding boxes (though I will hopefully be improving that soon).<br /><br />There are a few things you'll need to do to get it running on your own machine. First, you need Caffe (see my prior post if you're on Mac, or just follow the Caffe docs otherwise). You will also need numpy and opencv (I'm using 2.4.13, courtesy of homebrew). Inside of the demo.py and face_detector.py files, search for "<span style="background-color: white; color: #333333; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 12px; white-space: pre;">caffe_model_path" </span>and change the values to wherever you have the project on your machine. You also need to change the "<span style="background-color: white; color: #333333; font-family: Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 12px; white-space: pre;">caffe_root" </span>values to wherever you have Caffe installed.<br /><br />Once you've got all that sorted, you should be up and running! Things in the files are pretty clear, but if you have any questions then please reach out and I'll try to help out!